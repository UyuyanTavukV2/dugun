!function(w,D){"object"==typeof exports&&typeof module<"u"?module.exports=D():"function"==typeof define&&define.amd?define(D):w.ColorThief=D()}(this,function(){if(!w)var w={map:function(s,i){var d={};return i?s.map(function(f,g){return d.index=g,i.call(d,f)}):s.slice()},naturalOrder:function(s,i){return s<i?-1:s>i?1:0},sum:function(s,i){var d={};return s.reduce(i?function(f,g,p){return d.index=p,f+i.call(d,g)}:function(f,g){return f+g},0)},max:function(s,i){return Math.max.apply(null,i?w.map(s,i):s)}};var D=function(){var s=5,i=8-s;function f(r,t,e){return(r<<2*s)+(t<<s)+e}function g(r){var t=[],e=!1;function u(){t.sort(r),e=!0}return{push:function(n){t.push(n),e=!1},peek:function(n){return e||u(),void 0===n&&(n=t.length-1),t[n]},pop:function(){return e||u(),t.pop()},size:function(){return t.length},map:function(n){return t.map(n)},debug:function(){return e||u(),t}}}function p(r,t,e,u,n,o,h){this.r1=r,this.r2=t,this.g1=e,this.g2=u,this.b1=n,this.b2=o,this.histo=h}function _(){this.vboxes=new g(function(r,t){return w.naturalOrder(r.vbox.count()*r.vbox.volume(),t.vbox.count()*t.vbox.volume())})}function M(r,t){if(t.count()){var e=t.r2-t.r1+1,u=t.g2-t.g1+1,n=w.max([e,u,t.b2-t.b1+1]);if(1==t.count())return[t.copy()];var o,h,c,a,l=0,v=[],b=[];if(n==e)for(o=t.r1;o<=t.r2;o++){for(a=0,h=t.g1;h<=t.g2;h++)for(c=t.b1;c<=t.b2;c++)a+=r[f(o,h,c)]||0;v[o]=l+=a}else if(n==u)for(o=t.g1;o<=t.g2;o++){for(a=0,h=t.r1;h<=t.r2;h++)for(c=t.b1;c<=t.b2;c++)a+=r[f(h,o,c)]||0;v[o]=l+=a}else for(o=t.b1;o<=t.b2;o++){for(a=0,h=t.r1;h<=t.r2;h++)for(c=t.g1;c<=t.g2;c++)a+=r[f(h,c,o)]||0;v[o]=l+=a}return v.forEach(function(m,x){b[x]=l-m}),function(m){var x,E,y,I,C,q=m+"1",z=m+"2",O=0;for(o=t[q];o<=t[z];o++)if(v[o]>l/2){for(y=t.copy(),I=t.copy(),C=(x=o-t[q])<=(E=t[z]-o)?Math.min(t[z]-1,~~(o+E/2)):Math.max(t[q],~~(o-1-x/2));!v[C];)C++;for(O=b[C];!O&&v[C-1];)O=b[--C];return y[z]=C,I[q]=y[z]+1,[y,I]}}(n==e?"r":n==u?"g":"b")}}return p.prototype={volume:function(r){return this._volume&&!r||(this._volume=(this.r2-this.r1+1)*(this.g2-this.g1+1)*(this.b2-this.b1+1)),this._volume},count:function(r){var t=this.histo;if(!this._count_set||r){var e,u,n,o=0;for(e=this.r1;e<=this.r2;e++)for(u=this.g1;u<=this.g2;u++)for(n=this.b1;n<=this.b2;n++)o+=t[f(e,u,n)]||0;this._count=o,this._count_set=!0}return this._count},copy:function(){return new p(this.r1,this.r2,this.g1,this.g2,this.b1,this.b2,this.histo)},avg:function(r){var t=this.histo;if(!this._avg||r){var e,u,n,o,h=0,c=1<<8-s,a=0,l=0,v=0;for(u=this.r1;u<=this.r2;u++)for(n=this.g1;n<=this.g2;n++)for(o=this.b1;o<=this.b2;o++)h+=e=t[f(u,n,o)]||0,a+=e*(u+.5)*c,l+=e*(n+.5)*c,v+=e*(o+.5)*c;this._avg=h?[~~(a/h),~~(l/h),~~(v/h)]:[~~(c*(this.r1+this.r2+1)/2),~~(c*(this.g1+this.g2+1)/2),~~(c*(this.b1+this.b2+1)/2)]}return this._avg},contains:function(r){var t=r[0]>>i;return gval=r[1]>>i,bval=r[2]>>i,t>=this.r1&&t<=this.r2&&gval>=this.g1&&gval<=this.g2&&bval>=this.b1&&bval<=this.b2}},_.prototype={push:function(r){this.vboxes.push({vbox:r,color:r.avg()})},palette:function(){return this.vboxes.map(function(r){return r.color})},size:function(){return this.vboxes.size()},map:function(r){for(var t=this.vboxes,e=0;e<t.size();e++)if(t.peek(e).vbox.contains(r))return t.peek(e).color;return this.nearest(r)},nearest:function(r){for(var t,e,u,n=this.vboxes,o=0;o<n.size();o++)((e=Math.sqrt(Math.pow(r[0]-n.peek(o).color[0],2)+Math.pow(r[1]-n.peek(o).color[1],2)+Math.pow(r[2]-n.peek(o).color[2],2)))<t||void 0===t)&&(t=e,u=n.peek(o).color);return u},forcebw:function(){var r=this.vboxes;r.sort(function(n,o){return w.naturalOrder(w.sum(n.color),w.sum(o.color))});var t=r[0].color;t[0]<5&&t[1]<5&&t[2]<5&&(r[0].color=[0,0,0]);var e=r.length-1,u=r[e].color;u[0]>251&&u[1]>251&&u[2]>251&&(r[e].color=[255,255,255])}},{quantize:function(r,t){if(!r.length||t<2||t>256)return!1;var a,l,v,e=(a=r,v=new Array(1<<3*s),a.forEach(function(b){l=f(b[0]>>i,b[1]>>i,b[2]>>i),v[l]=(v[l]||0)+1}),v);e.forEach(function(){});var u=function(a,l){var v,b,m,x=1e6,E=0,y=1e6,I=0,C=1e6,q=0;return a.forEach(function(z){(v=z[0]>>i)<x?x=v:v>E&&(E=v),(b=z[1]>>i)<y?y=b:b>I&&(I=b),(m=z[2]>>i)<C?C=m:m>q&&(q=m)}),new p(x,E,y,I,C,q,l)}(r,e),n=new g(function(a,l){return w.naturalOrder(a.count(),l.count())});function o(a,l){for(var v,b=a.size(),m=0;m<1e3;){if(b>=l||m++>1e3)return;if((v=a.pop()).count()){var x=M(e,v),E=x[0],y=x[1];if(!E)return;a.push(E),y&&(a.push(y),b++)}else a.push(v),m++}}n.push(u),o(n,.75*t);for(var h=new g(function(a,l){return w.naturalOrder(a.count()*a.volume(),l.count()*l.volume())});n.size();)h.push(n.pop());o(h,t);for(var c=new _;h.size();)c.push(h.pop());return c}}}().quantize,P=function(s){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.width=this.canvas.width=s.width,this.height=this.canvas.height=s.height,this.context.drawImage(s,0,0,this.width,this.height)};P.prototype.getImageData=function(){return this.context.getImageData(0,0,this.width,this.height)};var k=function(){};return k.prototype.getColor=function(s,i){return void 0===i&&(i=10),this.getPalette(s,5,i)[0]},k.prototype.getPalette=function(s,i,d){var f=function(M){var r=M.colorCount,t=M.quality;if(void 0!==r&&Number.isInteger(r)){if(1===r)throw new Error("colorCount should be between 2 and 20. To get one color, call getColor() instead of getPalette()");r=Math.max(r,2),r=Math.min(r,20)}else r=10;return(void 0===t||Number.isInteger(t)||t<1)&&(t=10),{colorCount:r,quality:t}}({colorCount:i,quality:d}),g=new P(s),p=function(M,r,t){for(var e=M,u=[],n=0,o=void 0,h=void 0,c=void 0,a=void 0,l=void 0;n<r;n+=t)h=e[0+(o=4*n)],c=e[o+1],a=e[o+2],(void 0===(l=e[o+3])||l>=125)&&(h>250&&c>250&&a>250||u.push([h,c,a]));return u}(g.getImageData().data,g.width*g.height,f.quality),_=D(p,f.colorCount);return _?_.palette():null},k.prototype.getColorFromUrl=function(s,i,d){var f=document.createElement("img"),g=this;f.addEventListener("load",function(){var p=g.getPalette(f,5,d);i(p[0],s)}),f.src=s},k.prototype.getImageData=function(s,i){var d=new XMLHttpRequest;d.open("GET",s,!0),d.responseType="arraybuffer",d.onload=function(){if(200==this.status){var f=new Uint8Array(this.response);p=f.length;for(var g=new Array(p),p=0;p<f.length;p++)g[p]=String.fromCharCode(f[p]);var _=g.join(""),M=window.btoa(_);i("data:image/png;base64,"+M)}},d.send()},k.prototype.getColorAsync=function(s,i,d){var f=this;this.getImageData(s,function(g){var p=document.createElement("img");p.addEventListener("load",function(){var _=f.getPalette(p,5,d);i(_[0],this)}),p.src=g})},k});